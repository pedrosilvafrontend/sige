<div class="row m-b-24" [formGroup]="form">
  <div class="col-sm-12">
    <app-school-select
      formControlName="school"
      [data]="data.school || {}"
      [getParams]="{class:true}"
    ></app-school-select>
  </div>
  <div class="col-sm-6">
    <app-class-select
      formControlName="schoolClass"
      [schoolId]="schoolId"
    >
    </app-class-select>
  </div>
  <div class="col-sm-6">
    <app-curricular-component-select
      formControlName="curricularComponent"
      [classYearId]="form.get('schoolClass')?.value?.yearId || ''"
    ></app-curricular-component-select>
  </div>
  <div class="col-sm-6">
    <app-teacher-select
      formControlName="teacher"
      [schoolId]="schoolId"
    ></app-teacher-select>
  </div>
  <div class="col-sm-3">
    <mat-form-field appearance="outline" subscriptSizing="dynamic">
      <mat-label>{{ 'Start date' | translate }}</mat-label>
      <input matInput [formControl]="form.controls.date" [matDatepicker]="datePicker">
      <mat-datepicker-toggle matSuffix [for]="datePicker"></mat-datepicker-toggle>
      <mat-datepicker #datePicker></mat-datepicker>

      @if (form.get('date')?.hasError('required')) {
        <mat-error>
          {{ 'validations.required' | translate }}
        </mat-error>
      }
    </mat-form-field>
  </div>
  <div class="col-sm-3">
    <mat-form-field appearance="outline" subscriptSizing="dynamic">
      <mat-label>{{ 'End date' | translate }}</mat-label>
      <input matInput [matDatepicker]="endDatePicker" [formControl]="form.controls.endDate">
      <mat-datepicker-toggle matSuffix [for]="endDatePicker"></mat-datepicker-toggle>
      <mat-datepicker #endDatePicker></mat-datepicker>

      @if (form.get('endDate')?.hasError('required')) {
        <mat-error>
          {{ 'validations.required' | translate }}
        </mat-error>
      }
    </mat-form-field>
  </div>


  <div class="col-sm-12">
    @for (freq of form.controls.frequencies.controls; track i; let i = $index) {
      <div class="row" [formGroup]="freq">
        <div class="col-sm-6">
          <mat-form-field appearance="outline" subscriptSizing="dynamic">
            <mat-label>{{ 'frequency' | translate }}</mat-label>
            <mat-select
              formControlName="weekday"
            >
              @for (item of frequencies; track item) {
                <mat-option [value]="item">
                  @let prefix = item !== 'UNIQUE' ? 'ALL ' : '';
                  {{ prefix+item | translate }}
                </mat-option>
              }
            </mat-select>
            @if (form.get('weekday')?.hasError('required')) {
              <mat-error>
                {{ 'validations.required' | translate }}
              </mat-error>
            }
          </mat-form-field>
        </div>
        <div class="col-sm-5">
          <app-time-schedule-select formControlName="timeSchedule" [schoolClass]="form.controls.schoolClass.value || {}"></app-time-schedule-select>
        </div>
        <!--<div class="col-sm-3">
          <mat-form-field appearance="outline" subscriptSizing="dynamic">
            <mat-label>{{ 'Start hour' | translate }}</mat-label>
            <input matInput formControlName="startHour" [mask]="'Hh:m0'" [leadZeroDateTime]="true" [outputTransformFn]="transformHour" >
            @if (form.get('startHour')?.hasError('required')) {
              <mat-error>
                {{ 'validations.required' | translate }}
              </mat-error>
            }
          </mat-form-field>
        </div>
        <div class="col-sm-3">
          <mat-form-field appearance="outline" subscriptSizing="dynamic">
            <mat-label>{{ 'End hour' | translate }}</mat-label>
            <input matInput formControlName="endHour" [mask]="'Hh:m0'" [leadZeroDateTime]="true" [outputTransformFn]="transformHour">
            @if (form.get('endHour')?.hasError('required')) {
              <mat-error>
                {{ 'validations.required' | translate }}
              </mat-error>
            }
          </mat-form-field>
        </div>-->
        <div class="col-sm-1 text-center align-content-center mb-3">
          <button type="button" mat-icon-button (click)="removeFrequency(i)"
                  class="tbl-header-btn text-red">
            <mat-icon>delete_outline</mat-icon>
          </button>
        </div>
      </div>
    }
    <ui-button [disabled]="!form.controls.schoolClass.value" (onClick)="addFrequency()" class="text-nowrap mb-3 d-inline-block">
      {{ 'Add frequency' | translate }}
    </ui-button>
  </div>

  <div class="col-sm-12">
    <mat-form-field appearance="outline">
      <mat-label>{{ 'Description' | translate }}</mat-label>
      <textarea matInput formControlName="description"></textarea>
    </mat-form-field>
  </div>

<!--  <pre>{{ form.value | json }}</pre>-->
</div>
